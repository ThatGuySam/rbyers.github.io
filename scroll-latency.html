<!DOCTYPE html>
<html>
  <head>
    <meta name=viewport content="initial-scale=1">
    <link rel="stylesheet" href="scroll-latency.css"></link>
  </head>
  <body>
    <div id='console'>
      Periodic jank:
      <input type='checkbox' id='pjank'>
      <input type='number' id='ptime' value='200'>ms
      <br>
      Handler jank:
      <input type='checkbox' id='hjank'>
      <input type='number' id='htime' value='200'>ms
      <br>
      Touch listener:
      <select id='ltype'>
        <option selected>touchstart</option>
        <option>touchmove</option>
        <option>touchend</option>
      </select>
      <br>
      passive
      <input type='checkbox' id='passive'>
      preventDefault
      <input type='checkbox' id='pd'>
      requestAnimationFrame
      <input type='checkbox' id='requestAnimationFrame'>
      <br>
      show non-blocking events
      <input type='checkbox' id='snb'>
      <br>
      <div id='spinner'>Running</div>
      <div id=log>
      </div>
    </div>
    <div id=content>
      <h2>Scroll jank due to touch/wheel handlers demo</h2>
      <a href="https://github.com/RByers/rbyers.github.io/blob/master/scroll-latency.js">View on GitHub</a><br>
      <h3>Instructions</h3>
      The log shows the touch/wheel events which block scrolling (have cancelable=true).<br>
      Scroll the page, observing the latency associated with each event.<br>
      The 'running' animation represents the responsiveness of the JavaScript thread.
      Jank can be added to this thread as a regular repeating pattern ("periodic jank"),
      and/or directly inside of each touch/wheel handlers ("handler jank").<br>
      In Chrome 51+ and Safari 10, the touch/wheel listeners can be marked as
      <a href="https://github.com/WICG/EventListenerOptions/blob/gh-pages/explainer.md">passive</a>
      to keep them from being able to block the scroll.<br>
      When working properly (eg. <a href="https://www.chromestatus.com/features/5523910145605632">Chrome 49+</a>)
      this demo will be able to measure both types of jank.<br>
      Safari 9+ appears to work well (though only at millisecond precision and <a href="https://lists.webkit.org/pipermail/webkit-dev/2013-June/025027.html">
      with possible issues with NTP skew</a>).
      
      <h2>Scroll performance resources</h2>
      <ul>
        <li><a href="https://blog.chromium.org/2016/05/new-apis-to-help-developers-improve.html">https://blog.chromium.org/2016/05/new-apis-to-help-developers-improve.html</a></li>
        <li><a href="http://jankfree.org/">Jank Free</a></li>
        <li><a href="http://www.html5rocks.com/en/tutorials/speed/scrolling/">HTML5 Rocks - Scrolling Performance</a></li>
        <li><a href="https://developers.google.com/web/tools/chrome-devtools/profile/evaluate-performance/timeline-tool">How to Use the Timeline Tool</a></li>
        <li><a href="https://webperf.ninja/2015/jank-meter/">Measuring Webpage Jank</a></li>
      </ul>      
    </div>

    <script src="scroll-latency.js"></script>
  </body>
</html>

